<?php
global $current_user;
wp_get_current_user();
$email = $current_user ->user_email;


add_action( 'admin_footer', 'SitePenTest_ajax' );?>

    <div class="mo_wpns_divided_layout">
        <div id="wpns_message"></div>
        <div class="mo_wpns_setting_layout" id="">
            <div>
                <h3  style="font-size: 146%;" >
                    About miniOrange Penetration Testing Tool
                </h3>
            </div>
            <hr style="width: 100%;" fixed>
            <div style="font-size: 120%;padding-left: 5%;">


                <ul style="list-style-type:disc;">
                    <li>Scan your Website for top 10 OWASP Vulnerabilities such as SQL Injection, XSS, RFI (Remote File Inclusion), LFI (Local File Inclusion)etc.</li>
                    <li>Receive a detailed Report over the Email</li>
                    <li>Report contains Severity of Vulnerabilities, Proof of Concept and Possible Solution</li>
                    <li>Scans for Accessible WordPress REST API Endpoints</li>
                </ul>
            </div>
            <hr fixed>

            <h2  style="font-size: 150%;" >
                Enter the URL of your site here :
            </h2>
            <hr fixed>

            <div style="padding-left: 5%;">
                <table id="mospt_table" style="text-align: left; width: 60%;padding-top: 1%;border-collapse:separate; border-spacing: 0 15px; " >
                    <tr>
                        <td >
                            <b style="font-style: normal; font-size: 140%;">Your Domain :</b>
                        </td>
                        <td style="font-size: 140%;">
                            <input type="text" class="moSPT_border" name="" value="<?php echo site_url(); ?>" style="width: 100%" disabled>
                        </td>
                    </tr>
                    <tr>
                            <?php
                        if(strpos(site_url(), "localhost") == true)
                        {
                            ?>
                        <td colspan="2">
                            <p style="font-size: 100%;padding: 10px; color: red">* Localhost is not Allowed</p>
                            </td>
                            <?php
                        }
                            ?>


                    </tr>
                    <tr>
                        <td>
                            <b style=" font-size: 140%;">Email :</b>
                        </td>
                        <td>
                            <input class="moSPT_border" type="text" name="" id="sitepentest_email" placeholder="Enter your Email" value="<?php echo $email ?>"  />

                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <p style="font-size: 110%;padding: 10px;border: teal 1px solid;border-radius: 6px">Note: You will receive a report of testing on the email address provided above</p>
                        </td>
                    </tr>
                </table>
            </div>
            <div style="padding-left:5%; ">
                <input type="button" id="btnStartScanning" name="" value="Submit" class="mo_wpns_button mo_wpns_button1" >

            </div>
            <input type="hidden" id="current_site" value="<?php echo site_url() ?>">

        </div>



    </div>

<?php

function SitePenTest_ajax(){

    ?>
    <script type="text/javascript">

        function makeCall()
        {
            jQuery("#wpns_message").empty();
            var data = {
                'action': 'mo_sitePenTest',
                'mo_PenTest_ajax': 'Register_site',
                'email': jQuery("#sitepentest_email").val(),
                'domain': jQuery("#current_site").val(),
            };

                jQuery.post(ajaxurl, data, function (response) {
                jQuery('#wpns_message').empty()

                if(response.status === 'SUCCESS')
                {

                    jQuery('#wpns_message').append("<div class= 'notice notice-success is-dismissible' style='padding: 10px;  ' > " +response.message+ "</div>");
                    jQuery("#wpns_message").show();
                }
                else
                if(response.status ==='FAILURE')
                {
                    jQuery('#wpns_message').append("<div class= 'notice notice-error is-dismissible' style='padding: 10px;  ' > " +response.message+ "</div>");
                    jQuery("#wpns_message").show();
                }
                else
                {
                    jQuery('#wpns_message').append("<div class= 'notice notice-error is-dismissible' style='padding: 10px;  '>Error</div>");
                    jQuery("#wpns_message").show();
                }

            })
        }

        <?php
        if(!get_site_option('mospt_scanned'))
        {
            update_site_option('mospt_scanned',true);
        ?>
        makeCall()
        <?php
        }
        ?>


        function isEmail(email)
        {
            var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            return regex.test(email);
        }

        jQuery("#btnStartScanning").click(function()
        {
            if (!isEmail(jQuery("#sitepentest_email").val()))
            {
                jQuery('#wpns_message').append("<div class= 'notice notice-error is-dismissible' style='height : 25px;padding-top: 10px;  '>Email is not valid</div>");
                jQuery("#wpns_message").show();
                return false
            }

            makeCall()

        })

    </script>
    <?php
}

