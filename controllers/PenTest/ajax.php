<?php 
class MoSPT_ajax

{
	function __construct()
    {
		add_action( 'admin_init'  , array( $this, 'mo_PenTest_ajax' ) );
	}
	function mo_PenTest_ajax()
    {
        add_action( 'wp_ajax_mo_sitePenTest', array($this,'mo_sitePenTest') );
	}
	function mo_sitePenTest(){
			switch(sanitize_text_field($_POST['mo_PenTest_ajax']))
			{
				case "Register_site":
					$this->mo_register_domain(); break;
				case "Show_summary":
				    $this ->mo_show_summary();
				    break;
			}
		}

    static function mo_show_summary()
    {
        $token  = MoSPT_Constants::PTOKEN;
        $target = site_url();
        $url = MoSPT_Constants::PURL.'api/nsummary';
        $args =  array(
            'method'      => 'POST',
            'timeout'     => 45,
            'redirection' => 5,
            'httpversion' => '1.0',
            'blocking'    => true,
            'headers'     => array("Cache-Control"=>"no-cache","Content-Type"=>"application/json"),
            'body'        => json_encode(array('target'=> $target,'token' => $token)),
            'cookies'     => array()
        );
        $response = wp_remote_post($url , $args);
        $message =  sanitize_text_field($response['body']);
        return json_decode($message,true);
    }

    function mo_register_domain()
    {
        $email  = sanitize_email($_POST['email']);
        $target = sanitize_text_field($_POST['domain']);
        $token = MoSPT_Constants::PTOKEN;
        $url = MoSPT_Constants::PURL.'api/addHost';
        $args =  array(
            'method'      => 'POST',
            'timeout'     => 45,
            'redirection' => 5,
            'httpversion' => '1.0',
            'blocking'    => true,
            'headers'     => array("Cache-Control"=>"no-cache","Content-Type"=>"application/json"),
            'body'        => json_encode(array('target'=> $target, 'email' => $email, 'token' => $token)),
            'cookies'     => array()
        );
        $response = wp_remote_post($url , $args);
        $message =  sanitize_text_field($response['body']);
        wp_send_json(json_decode($message));
    }

}
new MoSPT_ajax;

?>